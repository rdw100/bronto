@page "/charthome"
@using Bronto.Stocks.Pwa.Pages.Chart
@using ScottPlot
@using ScottPlot.Blazor

<h3>Parent Component</h3>

<ChartToolbar
    OnChartTypeChanged="HandleChartTypeChanged"
    OnIntervalChanged="HandleIntervalChanged"
    OnRangeChanged="HandleRangeChanged"
    OnStartDateChanged="HandleStartDateChanged"
    OnEndDateChanged="HandleEndDateChanged" />

<ChartDisplay @ref="chartComponent" />

@code {
    private string selectedChartType = "Moving";
    private string selectedInterval = "1h";
    private string selectedRange = "1d";
    private DateTime? startDate = DateTime.Today.AddDays(-7);
    private DateTime? endDate = DateTime.Today;
    private ChartDisplay chartComponent;

    private void HandleChartTypeChanged(string chartType)
    {
        selectedChartType = chartType;
        RefreshChart();
    }

    private void HandleIntervalChanged(string interval)
    {
        selectedInterval = interval;
        RefreshChart();
    }

    private void HandleRangeChanged(string range)
    {
        selectedRange = range;
        RefreshChart();
    }

    private void HandleStartDateChanged(DateTime? date)
    {
        startDate = date;
        RefreshChart();
    }

    private void HandleEndDateChanged(DateTime? date)
    {
        endDate = date;
        RefreshChart();
    }

    private void RefreshChart()
    {
        chartComponent?.RefreshChart(selectedChartType, selectedInterval, selectedRange, startDate, endDate);
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            RefreshChart();
        }
    }
}